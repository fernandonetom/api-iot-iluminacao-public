<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,700;0,900;1,100;1,200;1,300;1,400;1,500;1,700&display=swap"
      rel="stylesheet"
    />
    <title>Document</title>
    <style>
      * {
        font-family: "Poppins";
      }
      .logo {
        stroke: #232931;
        fill: #fff;
        stroke-width: 1px;
        stroke-dasharray: 2000;
        stroke-dashoffset: 2000;
        animation: dash 3s linear alternate infinite,
          fill 3s ease-in-out alternate infinite 1s;
      }

      @keyframes dash {
        to {
          stroke-dashoffset: 0;
        }
      }
      @keyframes fill {
        to {
          fill: #232931;
        }
      }
    </style>
  </head>
  <body>
    <h4>postes</h4>
    <div class="dispositivos">
      <div class="checkbox">
        <label
          ><input type="checkbox" rel="2" onchange="change();" />Poste 2</label
        >
      </div>
      <div class="checkbox">
        <label
          ><input type="checkbox" rel="3" onchange="change();" />Poste 3</label
        >
      </div>
    </div>
    <h4>dados</h4>
    <div class="tipos">
      <div class="checkbox">
        <label
          ><input
            type="checkbox"
            rel="alerta"
            onchange="change();"
          />alerta</label
        >
      </div>
      <div class="checkbox">
        <label
          ><input
            type="checkbox"
            rel="movimentacao"
            onchange="change();"
          />movimentacao</label
        >
      </div>
      <div class="checkbox">
        <label
          ><input
            type="checkbox"
            rel="temperatura"
            onchange="change();"
          />temperatura</label
        >
      </div>
      <div class="checkbox">
        <label
          ><input
            type="checkbox"
            rel="umidade"
            onchange="change();"
          />umidade</label
        >
      </div>
      <div class="checkbox">
        <label
          ><input
            type="checkbox"
            rel="luminosidade"
            onchange="change();"
          />luminosidade</label
        >
      </div>
      <div class="checkbox">
        <label
          ><input
            type="checkbox"
            rel="tensao"
            onchange="change();"
          />tensao</label
        >
      </div>
    </div>

    <button onclick="submit()">Buscar dados</button>

    <div class="logo">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="381"
        height="227"
        viewBox="0 0 381 227"
      >
        <g transform="translate(-463 -529.031)">
          <g transform="translate(463 556.672)">
            <g transform="translate(0 0)">
              <path
                d="M317.453-500.78c-9.189.561-16.492,2.208-22.27,5.016a21.186,21.186,0,0,0-7.624,5.5c-5.056,5.056-7.383,10.031-8.626,18.3-.522,3.411-.6,12.559-.6,62.676v58.7H264.69v13.033h20.958l350.488-1v-12.038H292.377L292.5-410.7c.08-56.537.16-60.228.842-62.436,2.087-6.942,5.578-10.072,13.2-11.877,5.176-1.2,10.754-1.686,23.594-1.966l11.877-.24,1.4-1.083a6.862,6.862,0,0,0,2.728-5.738,6.8,6.8,0,0,0-5.136-6.621C339.683-501.022,322.83-501.141,317.453-500.78Z"
                transform="translate(-264.69 500.998)"
              />
              <path
                d="M557.66-401.067c0,3.812,3.892,8.907,7.784,10.232a12.6,12.6,0,0,0,12.639-2.608c2.087-2.046,3.652-5.136,3.652-7.262v-1.485H557.66Z"
                transform="translate(-505.499 419.782)"
              />
              <path
                d="M515.673-345.25c-4.373,2.528-4.9,3.009-4.494,4.093.4,1,1.4.682,5.777-1.805,4.775-2.769,5.416-3.29,5.1-4.173C521.611-348.261,520.087-347.779,515.673-345.25Z"
                transform="translate(-467.203 375.001)"
              />
              <path
                d="M673.922-347.477c-.4,1,.2,1.524,4.695,4.132,4.7,2.728,5.938,3.05,6.139,1.565.121-.723-.682-1.325-4.455-3.531C675.769-347.918,674.284-348.44,673.922-347.477Z"
                transform="translate(-600.976 375.18)"
              />
              <path
                d="M561.62-324.935c-.24.281-1.565,2.487-2.929,4.894-1.966,3.37-2.448,4.494-2.126,5.015.922,1.444,1.645.924,3.851-2.849,3.531-6.059,3.611-6.18,2.849-6.9C562.5-325.536,562.142-325.577,561.62-324.935Z"
                transform="translate(-504.524 356.651)"
              />
              <path
                d="M650.816-324.824c-.963.362-.522,1.766,2.007,6.139,2.528,4.414,3.009,4.975,4.093,4.574,1-.4.682-1.485-1.725-5.7C652.061-325.185,651.981-325.3,650.816-324.824Z"
                transform="translate(-581.682 356.339)"
              />
              <path
                d="M616.961-315.859c-.321.361-.442,2.368-.362,6.1l.121,5.578h2l.121-5.778c.08-4.373-.039-5.857-.4-6.139C617.723-316.541,617.483-316.5,616.961-315.859Z"
                transform="translate(-553.925 349.26)"
              />
            </g>
          </g>
          <text
            transform="translate(549 699.031)"
            font-size="162"
            fontFamily="Poppins-Medium, Poppins"
            font-weight="500"
            letter-spacing="0.03em"
          >
            <tspan x="0" y="0">SiPi</tspan>
          </text>
        </g>
      </svg>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
      const tipos = ["alerta", "temperatura", "movimentacao"];
      const id = [2, 3];

      async function buscar(id, tipos) {
        //let response = {}
        // await Promise.all(id.map(async (id)=> {
        //   response = {...response, [id]: null}
        //   await Promise.all(tipos.map(async (tipo)=> {
        //     const {data} = await axios.get(`http://localhost:3000/storage/list/${tipo}`, {id, rangeType: "data", data: "2020-09-02"});
        //     response[id] = {...response[id], [tipo]: data}
        //   }))
        // }))

        let response = [];
        await Promise.all(
          id.map(async (id) => {
            responseData = { id };
            await Promise.all(
              tipos.map(async (tipo) => {
                const {
                  data,
                } = await axios.post(
                  `http://localhost:3000/storage/list/${tipo}`,
                  { id, rangeType: "data", data: "2020-09-02" }
                );
                responseData = { ...responseData, [tipo]: data };
              })
            );
            response.push(responseData);
          })
        );
        // await Promise.all(tipos.map(async (tipo)=> {
        //   const {data} = await axios.post(`http://localhost:3000/storage/list/${tipo}`, {id: 3, rangeType: "hoje"});
        //   response = {...response, [tipo]: data}
        // }))
        console.log(response);
      }
      //buscar(id, tipos);

      function change() {
        // var dispositivos = document.querySelectorAll(".dispositivos input[type='checkbox']");
        // var tipos = document.querySelectorAll(".tipos input[type='checkbox']");
        // var filtros = {
        //   dispositivos: getClassOfCheckedCheckboxes(dispositivos),
        //   tipos: getClassOfCheckedCheckboxes(tipos)
        // };
        // console.log(filtros.dispositivos, filtros.dispositivos);
      }
      function submit() {
        var dispositivos = document.querySelectorAll(
          ".dispositivos input[type='checkbox']"
        );
        var tipos = document.querySelectorAll(".tipos input[type='checkbox']");
        var filtros = {
          dispositivos: getClassOfCheckedCheckboxes(dispositivos),
          tipos: getClassOfCheckedCheckboxes(tipos),
        };

        buscar(filtros.dispositivos, filtros.tipos);
      }
      function getClassOfCheckedCheckboxes(checkboxes) {
        var classes = [];

        if (checkboxes && checkboxes.length > 0) {
          for (var i = 0; i < checkboxes.length; i++) {
            var cb = checkboxes[i];

            if (cb.checked) {
              classes.push(cb.getAttribute("rel"));
            }
          }
        }

        return classes;
      }
    </script>
  </body>
</html>
